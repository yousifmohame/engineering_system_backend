// ./prisma/schema.prisma (Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…ØµØ­Ø­ v3 - Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Json)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===============================================
// 2. Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ (Models) Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ù†Ø¸Ø§Ù…
// ===============================================

// ------ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø´Ø§Ø´Ø© 300) (Ù…ÙØ­Ø¯Ø« Ø¨Ø§Ù„ÙƒØ§Ù…Ù„) ------
model Client {
  id         String @id @default(cuid())
  clientCode String @unique // ÙƒÙˆØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„

  // --- Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„ÙØ±ÙŠØ¯Ø© (ÙŠØ¬Ø¨ Ø£Ù† ØªØ¨Ù‚Ù‰ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø¹Ù„Ù‰) ---
  mobile   String  @unique
  email    String? @unique
  idNumber String  @unique

  // --- Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†ÙˆØ¹ "Json" Ù„Ù„ÙƒØ§Ø¦Ù†Ø§Øª Ø§Ù„Ù…ØªØ¯Ø§Ø®Ù„Ø© ---
  // Ù‡Ø°Ø§ ÙŠØ·Ø§Ø¨Ù‚ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª (Interfaces) ÙÙŠ Ø´Ø§Ø´Ø© v19
  name           Json // (ÙŠØ·Ø§Ø¨Ù‚ ClientName)
  contact        Json // (ÙŠØ·Ø§Ø¨Ù‚ ClientContact)
  address        Json? // (ÙŠØ·Ø§Ø¨Ù‚ ClientAddress)
  identification Json // (ÙŠØ·Ø§Ø¨Ù‚ ClientIdentification)

  // --- Ø¨Ø§Ù‚ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø§Ø´Ø© 300 ---
  type                 String // (ÙØ±Ø¯ØŒ Ø´Ø±ÙƒØ©ØŒ Ø¬Ù‡Ø© Ø­ÙƒÙˆÙ…ÙŠØ©)
  category             String? // (VIP, Ù…Ø¤Ø³Ø³Ø©, Ø¹Ø§Ø¯ÙŠ)
  nationality          String?
  occupation           String?
  company              String?
  taxNumber            String?
  rating               Int?    @default(3)
  secretRating         Int?    @default(50)
  grade                String? // (Ø£, Ø¨, Ø¬)
  gradeScore           Int?
  completionPercentage Float?
  isActive             Boolean @default(true)
  notes                String?
  createdBy            String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // --- Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª ---
  transactions Transaction[]
  contracts    Contract[]
  quotations   Quotation[]
  attachments  Attachment[]
  activityLogs ActivityLog[]
  documents    Document[]
}

model Payment {
  id        String   @id @default(cuid())
  amount    Float
  date      DateTime @default(now())
  method    String // (Ù†Ù‚Ø¯ÙŠ, Ø´ÙŠÙƒ, ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ, ...)
  reference String? // (Ø±Ù‚Ù… Ø§Ù„Ø´ÙŠÙƒ Ø£Ùˆ Ø§Ù„ØªØ­ÙˆÙŠÙ„)
  notes     String?

  // âœ… ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù‚Ø© Ø¨Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø°ÙŠ Ø§Ø³ØªÙ„Ù… Ø§Ù„Ø¯ÙØ¹Ø©
  receivedBy    Employee @relation("EmployeeToPayment", fields: [receivedById], references: [id])
  receivedById  String

  transaction   Transaction @relation(fields: [transactionId], references: [id])
  transactionId String

  @@index([transactionId])
  @@index([receivedById])
}

model ActivityLog {
  id          String   @id @default(cuid())
  date        DateTime @default(now())
  action      String // (Ø¥Ù†Ø´Ø§Ø¡, ØªØ¹Ø¯ÙŠÙ„, Ø¥Ø¶Ø§ÙØ© Ø¯ÙØ¹Ø©, ...)
  description String
  category    String // (Ù…Ø¹Ø§Ù…Ù„Ø©, Ø¯ÙØ¹Ø©, ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª, ...)

  performedBy   Employee @relation("EmployeeToActivityLog", fields: [performedById], references: [id])
  performedById String

  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)
  clientId String

  @@index([clientId])
  @@index([performedById])
}

// ------ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªØµÙ†ÙŠÙ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ (Ù„ØªØ¨ÙˆÙŠØ¨ 300-12) ------
model ClientClassification {
  id          String  @id @default(cuid())
  name        String  @unique
  color       String
  description String?
  isActive    Boolean @default(true)
}

// ------ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… (Ù„ØªØ¨ÙˆÙŠØ¨ 300-12) ------
model SystemSettings {
  id String @id @default("singleton") // Ù†Ø¶Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø³Ø¬Ù„ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·

  gradingCriteria Json? // (GradingCriteria)
  gradeThresholds Json? // (GradeThresholds)

  updatedAt DateTime @updatedAt
}

// ===============================================
// (Ù…ÙØ¹Ø¯Ù„ ÙˆÙ…ÙØµØ­Ø­) Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© (Ø§Ù„ÙƒÙŠØ§Ù† Ø§Ù„ÙØ¹Ù„ÙŠ/House)
// ===============================================
model Transaction {
  id              String @id @default(cuid())
  transactionCode String @unique
  title           String // (Ù‡Ø°Ø§ Ù‡Ùˆ "Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©" Ù…Ù† Ø§Ù„ØªØ¨ÙˆÙŠØ¨ 1)

  // --- 1. Ø¹Ù„Ø§Ù‚Ø© Ø¨Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© (Ø§Ù„Ù‚Ø§Ù„Ø¨) ---
  transactionType   TransactionType? @relation(fields: [transactionTypeId], references: [id])
  transactionTypeId String?

  // --- 2. Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ù…Ù† Ø§Ù„ØªØ¨ÙˆÙŠØ¨ 1 Ùˆ 2) ---
  status      String  @default("Draft")
  statusColor String? @default("#6b7280")
  priority    String? @default("Ù…ØªÙˆØ³Ø·")
  description String?
  location    String?
  deedNumber  String?

  // --- 3. Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†Ø³ÙˆØ®Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ù„Ø¨ (Ù„Ù„ØªØªØ¨Ø¹) ---
  category    String? // (Ù…Ù†Ø³ÙˆØ® Ù…Ù† TransactionType)
  complexity  String? // (Ù…Ù†Ø³ÙˆØ® Ù…Ù† TransactionType)
  duration    Int?    // (Ø§Ù„Ù…Ø¯Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ©ØŒ Ù‚Ø¯ ØªØ¨Ø¯Ø£ Ø¨Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©)
  progress    Float?  @default(0)

  // --- 4. Ø­Ù‚ÙˆÙ„ Ù…Ø§Ù„ÙŠØ© (ÙØ¹Ù„ÙŠØ©) ---
  totalFees       Float?    @default(0) // (Ù‚Ø¯ ÙŠØ¨Ø¯Ø£ Ø¨Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©)
  paidAmount      Float?    @default(0)
  remainingAmount Float?    @default(0)
  fees        Json?   // (TransactionFee[]) Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„ÙØ¹Ù„ÙŠØ© (Ù…Ù†Ø³ÙˆØ®Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ù„Ø¨)

  // --- 5. Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ±ÙˆØ«Ø© (Ù…Ù†Ø³ÙˆØ®Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ù„Ø¨) ---
  tasks       Task[]   // (Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Task Ø§Ù„Ø­Ø§Ù„ÙŠØŒ Ø³Ù†Ù‚ÙˆÙ… Ø¨Ù†Ø³Ø® Ø§Ù„Ù…Ù‡Ø§Ù… Ø¥Ù„ÙŠÙ‡)
  
  // --- âœ…âœ…âœ… Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ âœ…âœ…âœ… ---
  // (Ø£Ø¹Ø¯Ù†Ø§Ù‡ Ø¥Ù„Ù‰ Ø¹Ù„Ø§Ù‚Ø© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Json)
  documents   Document[] 
  
  authorities String[] // (string[]) Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„ÙØ¹Ù„ÙŠØ©
  stages      Json?    // (TransactionStage[]) Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„ÙØ¹Ù„ÙŠØ©
  warnings    String[]
  notes       String[]
  requestPurposes Json?
  
  // --- 6. Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª ---
  client   Client @relation(fields: [clientId], references: [id])
  clientId String

  project   Project? @relation(fields: [projectId], references: [id])
  projectId Int?

  contract   Contract? @relation(fields: [contractId], references: [id])
  contractId String?

  // --- 7. Ù…Ø±ÙÙ‚Ø§Øª ÙˆØ­Ø±ÙƒØ§Øª ---
  attachments Attachment[]
  payments    Payment[]
  
  // --- 8. ØªÙˆØ§Ø±ÙŠØ® ---
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  completedDate DateTime?
}

model TransactionType {
  id          String  @id @default(cuid())
  code        String  @unique // ÙƒÙˆØ¯ Ø¯Ø§Ø®Ù„ÙŠ (Ù…Ø«Ø§Ù„: BLD-PERMIT)
  name        String  @unique // Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶ (Ù…Ø«Ø§Ù„: ØªØ±Ø®ÙŠØµ Ø¨Ù†Ø§Ø¡)
  description String? // ÙˆØµÙ Ù„Ù„Ù†ÙˆØ¹
  isActive    Boolean @default(true)

  // --- [Ø¥Ø¶Ø§ÙØ§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…Ù„ÙÙƒ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ] ---
  category    String? // (licenses, properties, etc.)
  categoryAr  String? // (Ø§Ù„ØªØ±Ø§Ø®ÙŠØµØŒ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª)
  duration    Int?    @default(0) // Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© Ø¨Ø§Ù„Ø£ÙŠØ§Ù…
  estimatedCost Float?  @default(0) // Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©
  complexity  String? // (simple, medium, complex)

  tasks       Json?   // (TransactionTask[]) Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
  documents   String[] // (string[]) Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
  authorities String[] // (string[]) Ø§Ù„Ø¬Ù‡Ø§Øª Ø°Ø§Øª Ø§Ù„Ø¹Ù„Ø§Ù‚Ø©
  fees        Json?   // (TransactionFee[]) Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
  stages      Json?   // (TransactionStage[]) Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
  warnings    String[] // (string[]) ØªØ­Ø°ÙŠØ±Ø§Øª
  notes       String[] // (string[]) Ù…Ù„Ø§Ø­Ø¸Ø§Øª
  // --- [Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª] ---

  // Ø¹Ù„Ø§Ù‚Ø© Ø¹ÙƒØ³ÙŠØ©: Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹ Ù…ÙØ³ØªØ®Ø¯Ù… ÙÙŠ Ø£ÙŠ Ù…Ø¹Ø§Ù…Ù„Ø§Øª
  transactions Transaction[]
}

// ===============================================
// Ù†Ù…ÙˆØ°Ø¬ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª (Ø§Ù„Ù…Ø®ØªØµØ±Ø© ÙˆØ§Ù„ØªÙØµÙŠÙ„ÙŠØ©)
// ===============================================
model RequestPurpose {
  id          String  @id @default(cuid())
  type        String  // 'brief' (Ù…Ø®ØªØµØ±) Ø£Ùˆ 'detailed' (ØªÙØµÙŠÙ„ÙŠ)
  name        String  // Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ (Ù…Ø«Ù„: Ø¥ØµØ¯Ø§Ø±)
  nameEn      String  // Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ (Ù…Ø«Ù„: Issuance)
  description String? // Ø§Ù„ÙˆØµÙ
  icon        String? // (Ù…Ø«Ù„: 'ğŸ“‹')
  color       String? // (Ù…Ø«Ù„: '#2563eb')
  isActive    Boolean @default(true) // Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø¸Ù‡ÙˆØ±Ù‡

  // Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… ØªÙƒØ±Ø§Ø± Ù†ÙØ³ Ø§Ù„ØºØ±Ø¶ Ù…Ø±ØªÙŠÙ†
  @@unique([type, name]) 
}

// ------ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ù‡Ù…Ø© (Ø´Ø§Ø´Ø© 825) ------
// ------ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ù‡Ù…Ø© (Ø´Ø§Ø´Ø© 825) ------
// ------ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ù‡Ù…Ø© (Ø´Ø§Ø´Ø© 825) ------
model Task {
  id          String    @id @default(cuid())
  taskNumber  String?   @unique // <-- Ø£Ø¶ÙÙ†Ø§ Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø§Ø³ØªÙÙ‡Ø§Ù… Ù‡Ù†Ø§
  title       String
  description String?
  status      String    @default("Pending")
  dueDate     DateTime?
  
  // --- [Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©] ---
  priority        String?   @default("medium") // (high, medium, low, urgent)
  progress        Int?      @default(0)
  category        String?
  assignedById    String?   // (ID Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø°ÙŠ Ø£Ø³Ù†Ø¯ Ø§Ù„Ù…Ù‡Ù…Ø©)
  receivedDate    DateTime?
  completedDate   DateTime?
  attachmentsCount Int?      @default(0)
  commentsCount   Int?      @default(0)
  fees            Json?     // (Ù„ØªØ®Ø²ÙŠÙ† ÙƒØ§Ø¦Ù† Ø§Ù„Ø£ØªØ¹Ø§Ø¨)
  // -------------------------

  createdAt   DateTime  @default(now())

  transaction   Transaction @relation(fields: [transactionId], references: [id])
  transactionId String

  assignedTo   Employee? @relation("EmployeeToTask", fields: [assignedToId], references: [id])
  assignedToId String?
  
  @@index([assignedToId]) // [Ø¬Ø¯ÙŠØ¯] Ù„ØªØ­Ø³ÙŠÙ† Ø£Ø¯Ø§Ø¡ Ø¬Ù„Ø¨ "Ù…Ù‡Ø§Ù…ÙŠ"
  @@index([transactionId])
}

// ------ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† (Ø´Ø§Ø´Ø© 817) ------
model Employee {
  id                String                  @id @default(cuid())
  employeeCode      String                  @unique @default(cuid())
  name              String
  nameEn            String?
  nationalId        String                  @unique
  email             String                  @unique
  phone             String                  @unique
  position          String
  department        String
  hireDate          DateTime
  baseSalary        Float?
  jobLevel          Int?
  type              String                  @default("full-time")
  status            String                  @default("active")
  nationality       String?
  gosiNumber        String?
  iqamaNumber       String?
  performanceRating Float?
  frozenUntil       DateTime?
  frozenReason      String?
  password          String
  refreshToken      String?
  permissionsCount  Int? // âœ… Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯
  createdAt         DateTime                @default(now())
  updatedAt         DateTime                @updatedAt
  attachments       Attachment[]            @relation("EmployeeAttachments")
  attendanceRecords EmployeeAttendance[]
  leaveRequests     EmployeeLeaveRequest[]
  skills            EmployeeSkill[]
  certifications    EmployeeCertification[]
  evaluations       EmployeeEvaluation[]
  promotions        EmployeePromotion[]

  roles               JobRole[]      @relation("EmployeeToJobRole")
  specialPermissions  Permission[]   @relation("EmployeeToSpecialPermission")
  managedProjects     Project[]
  assignedTasks       Task[]         @relation("EmployeeToTask")
  sentMessages        Message[]      @relation("SenderToMessage")
  conversations       Conversation[] @relation("EmployeeToConversation")
  uploadedAttachments Attachment[]
  paymentsReceived    Payment[]     @relation("EmployeeToPayment")
  activitiesPerformed ActivityLog[] @relation("EmployeeToActivityLog")
  ownedDocuments Document[] @relation("OwnedDocuments")
  docPermissions DocumentPermission[] @relation("GrantedPermissions")
  documentActivities DocumentActivity[]
  documentAccess DocumentPermission[]
  createdClassifications DocumentClassification[] @relation("CreatedClassifications")
}

// Ù†Ù…ÙˆØ°Ø¬ Ù„Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ± (Ù„ØªØ§Ø¨ 817-07)
model EmployeeAttendance {
  id       String    @id @default(cuid())
  date     DateTime  @db.Date
  status   String // (Present, Absent, On Leave)
  checkIn  DateTime? @db.Time
  checkOut DateTime? @db.Time
  notes    String?

  employee   Employee @relation(fields: [employeeId], references: [id])
  employeeId String

  @@index([employeeId, date])
}

// Ù†Ù…ÙˆØ°Ø¬ Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª (Ù„ØªØ§Ø¨ 817-07)
model EmployeeLeaveRequest {
  id        String   @id @default(cuid())
  type      String // (Ø³Ù†ÙˆÙŠØ©, Ù…Ø±Ø¶ÙŠØ©, ...)
  startDate DateTime @db.Date
  endDate   DateTime @db.Date
  status    String   @default("Pending") // (Pending, Approved, Rejected)
  reason    String?

  employee   Employee @relation(fields: [employeeId], references: [id])
  employeeId String

  @@index([employeeId])
}

// Ù†Ù…ÙˆØ°Ø¬ Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù (Ù„ØªØ§Ø¨ 817-08)
model EmployeeSkill {
  id       String @id @default(cuid())
  category String // (ÙÙ†ÙŠØ©, Ø¥Ø¯Ø§Ø±ÙŠØ©, Ù„ØºØ§Øª)
  skill    String // (AutoCAD, React, Ø¥Ø¯Ø§Ø±Ø© Ù…Ø´Ø§Ø±ÙŠØ¹)
  level    String // (Ù…Ø¨ØªØ¯Ø¦, Ù…ØªÙˆØ³Ø·, Ø®Ø¨ÙŠØ±)

  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  employeeId String

  @@index([employeeId])
}

// Ù†Ù…ÙˆØ°Ø¬ Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù (Ù„ØªØ§Ø¨ 817-08)
model EmployeeCertification {
  id         String    @id @default(cuid())
  name       String // (PMP, Ø´Ù‡Ø§Ø¯Ø© AWS)
  authority  String // (PMI, Amazon)
  issueDate  DateTime  @db.Date
  expiryDate DateTime? @db.Date

  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  employeeId String

  @@index([employeeId])
}

// Ù†Ù…ÙˆØ°Ø¬ Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù (Ù„ØªØ§Ø¨ 817-09)
model EmployeeEvaluation {
  id        String   @id @default(cuid())
  date      DateTime @db.Date
  evaluator String // (Ø§Ø³Ù… Ø§Ù„Ù…ÙÙ‚ÙŠÙ‘Ù… Ø£Ùˆ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©)
  rating    Float // (Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ù…Ù† 5)
  comments  String?

  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  employeeId String

  @@index([employeeId, date])
}

// Ù†Ù…ÙˆØ°Ø¬ Ù„ØªØ±Ù‚ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ¸Ù (Ù„ØªØ§Ø¨ 817-10)
model EmployeePromotion {
  id          String   @id @default(cuid())
  date        DateTime @db.Date
  oldPosition String
  newPosition String
  oldLevel    Int
  newLevel    Int
  notes       String?

  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  employeeId String

  @@index([employeeId, date])
}

// ------ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ© (Ø´Ø§Ø´Ø© 903) ------
model JobRole {
  id               String    @id @default(cuid())
  code             String    @unique
  nameAr           String
  nameEn           String?
  description      String?
  responsibilities String[] // âœ… ØªØ­ÙˆÙŠÙ„Ù‡ Ø¥Ù„Ù‰ Ù…ØµÙÙˆÙØ© Ù†ØµÙˆØµ
  level            String?
  department       String?
  status           String    @default("active")
  canAssignTasks   Boolean   @default(true)
  allowMultiple    Boolean   @default(true)
  allowMultiRole   Boolean   @default(true)
  order            Int?
  createdDate      DateTime  @default(now())
  lastModified     DateTime  @updatedAt
  modifiedBy       String?
  parentRole       JobRole?  @relation("RoleHierarchy", fields: [parentRoleId], references: [id])
  parentRoleId     String?
  childRoles       JobRole[] @relation("RoleHierarchy")

  employees   Employee[]   @relation("EmployeeToJobRole")
  permissions Permission[] @relation("JobRoleToPermission")
}

// ------ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (Ø´Ø§Ø´Ø© 902) ------
model Permission {
  id           String     @id @default(cuid())
  code         String     @unique
  name         String
  description  String?
  level        String
  screenId     String?
  screenName   String?
  tabId        String?
  tabName      String?
  actionType   String?
  status       String     @default("active")
  frozenType   String?
  frozenDate   DateTime?
  frozenUntil  DateTime?
  frozenBy     String?
  frozenReason String?
  createdDate  DateTime   @default(now())
  lastModified DateTime   @updatedAt
  modifiedBy   String?
  roles        JobRole[]  @relation("JobRoleToPermission")
  employees    Employee[] @relation("EmployeeToSpecialPermission")

  // --- âœ… Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù‡Ù†Ø§ ---
  groups PermissionGroup[] @relation("GroupToPermission")
  // ---------------------------
}

// --- âœ… Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ---
// ------ Ù†Ù…ÙˆØ°Ø¬ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (Ø¬Ø¯ÙŠØ¯) ------
model PermissionGroup {
  id          String  @id @default(cuid())
  code        String  @unique
  name        String
  description String?

  // --- âœ… Ø¹Ù„Ø§Ù‚Ø© Many-to-Many Ù…Ø¹ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ---
  permissions Permission[] @relation("GroupToPermission")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([code])
}

// ------ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ (Ø·Ù„Ø¨Ùƒ Ø§Ù„Ø£ØµÙ„ÙŠ) ------
model Project {
  id          Int       @id @default(autoincrement())
  title       String    @unique
  description String?
  status      String    @default("Pending")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  manager     Employee? @relation(fields: [managerId], references: [id])
  managerId   String?

  transactions Transaction[]
}

// ------ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¹Ù‚Ø¯ (Ø´Ø§Ø´Ø© 814) ------
model Contract {
  id           String   @id @default(cuid())
  contractCode String   @unique
  title        String
  startDate    DateTime
  endDate      DateTime
  totalValue   Float
  status       String   @default("Active")

  client   Client @relation(fields: [clientId], references: [id])
  clientId String

  transactions Transaction[]
  quotation    Quotation?    @relation(fields: [quotationId], references: [id])
  quotationId  String?       @unique
  attachments  Attachment[]
}

// ------ Ù†Ù…ÙˆØ°Ø¬ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± (Ø´Ø§Ø´Ø© 815) ------
model Quotation {
  id            String   @id @default(cuid())
  quotationCode String   @unique
  status        String   @default("Pending")
  totalValue    Float
  createdAt     DateTime @default(now())

  client   Client @relation(fields: [clientId], references: [id])
  clientId String

  contract Contract?
}

// ------ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª (Ø´Ø§Ø´Ø© 901) ------
model Attachment {
  id        String   @id @default(cuid())
  fileName  String
  filePath  String   @unique
  fileType  String
  fileSize  Int
  createdAt DateTime @default(now())

  uploadedBy   Employee @relation(fields: [uploadedById], references: [id])
  uploadedById String

  transaction   Transaction? @relation(fields: [transactionId], references: [id])
  transactionId String?

  contract   Contract? @relation(fields: [contractId], references: [id])
  contractId String?

  client   Client? @relation(fields: [clientId], references: [id])
  clientId String?

  // --- Ø£Ø¶Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ ---
  employee   Employee? @relation("EmployeeAttachments", fields: [employeeId], references: [id], onDelete: Cascade)
  employeeId String?
}

// ------ Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø© (Ù„Ù„Ø´Ø§Øª) ------
model Conversation {
  id        String   @id @default(cuid())
  name      String?
  createdAt DateTime @default(now())

  participants Employee[] @relation("EmployeeToConversation")
  messages     Message[]
}

model Message {
  id        String   @id @default(cuid())
  content   String
  createdAt DateTime @default(now())

  conversation   Conversation @relation(fields: [conversationId], references: [id])
  conversationId String

  sender   Employee @relation("SenderToMessage", fields: [senderId], references: [id])
  senderId String
}

// Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© (ÙŠØ·Ø§Ø¨Ù‚ FileItem)
model Document {
  id        String   @id @default(cuid())
  fileNumber String   @unique // Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù
  name      String   // Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø£Ùˆ Ø§Ù„Ù…Ø¬Ù„Ø¯
  type      String   // 'file' Ø£Ùˆ 'folder'
  extension String?  // Ø§Ù…ØªØ¯Ø§Ø¯ Ø§Ù„Ù…Ù„Ù
  size      Int?     // Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù (Ø¨Ø§Ù„Ø¨Ø§ÙŠØª)
  filePath  String?  @unique // Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ÙØ¹Ù„ÙŠ Ù„Ù„Ù…Ù„Ù Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…
  
  createdAt DateTime @default(now())
  modifiedAt DateTime @updatedAt
  
  ownerId   String
  owner     Employee @relation("OwnedDocuments", fields: [ownerId], references: [id])
  classificationId String?
  classification   DocumentClassification? @relation(fields: [classificationId], references: [id])
  tags      String[] // ÙˆØ³ÙˆÙ…
  version   String   @default("1.0")
  isShared  Boolean  @default(false)
  downloads Int      @default(0)
  views     Int      @default(0)

  // Ù„Ø¥Ø¯Ø§Ø±Ø© Ù‡ÙŠÙƒÙ„ÙŠØ© Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª
  path      String   // Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (e.g., "/Contracts/ProjectX")
  parentId  String?
  parent    Document? @relation("FolderHierarchy", fields: [parentId], references: [id], onDelete:Cascade)
  children  Document[] @relation("FolderHierarchy")

  // Ø±Ø¨Ø· Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ø¨Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª ÙˆØ§Ù„Ø¹Ù…Ù„Ø§Ø¡
  transactionId String?
  transaction   Transaction? @relation(fields: [transactionId], references: [id])
  
  clientId  String?
  client    Client? @relation(fields: [clientId], references: [id])

  // Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ÙˆØ§Ù„Ø£Ù†Ø´Ø·Ø©
  permissions DocumentPermission[]
  activities  DocumentActivity[]
  
  @@index([ownerId])
  @@index([parentId])
  @@index([transactionId])
  @@index([clientId])
  @@index([classificationId])
}

// Ù†Ù…ÙˆØ°Ø¬ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© (ÙŠØ·Ø§Ø¨Ù‚ FilePermission)
model DocumentPermission {
  id        String   @id @default(cuid())
  permissionNumber String @unique @default(cuid())
  
  documentId String
  document   Document @relation(fields: [documentId], references: [id], onDelete: Cascade)
  
  userId    String
  user      Employee @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  accessLevel String // 'view', 'edit', 'delete', 'admin'
  expiryDate  DateTime?
  
  grantedAt   DateTime @default(now())
  grantedById String
  grantedBy   Employee @relation("GrantedPermissions", fields: [grantedById], references: [id])

  @@unique([documentId, userId]) // Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¹Ø·Ø§Ø¡ ØµÙ„Ø§Ø­ÙŠØªÙŠÙ† Ù„Ù†ÙØ³ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ù…Ù„Ù
  @@index([userId])
}

// Ù†Ù…ÙˆØ°Ø¬ Ø£Ù†Ø´Ø·Ø© Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© (ÙŠØ·Ø§Ø¨Ù‚ FileActivity)
model DocumentActivity {
  id          String   @id @default(cuid())
  activityNumber String @unique @default(cuid())
  
  documentId String
  document   Document @relation(fields: [documentId], references: [id], onDelete: Cascade)
  
  fileName    String   // Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù (Ù„Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹)
  action      String   // 'upload', 'download', 'edit', 'delete', 'share', 'view'
  
  userId      String
  user        Employee @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  timestamp   DateTime @default(now())
  ipAddress   String?
  details     String?

  @@index([documentId])
  @@index([userId])
}

// Ù†Ù…ÙˆØ°Ø¬ ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ (Ù„ØªØ§Ø¨ 901-04)
model DocumentClassification {
  id          String  @id @default(cuid())
  name        String  @unique // Ø§Ø³Ù… Ø§Ù„ØªØµÙ†ÙŠÙ (Ù…Ø«Ø§Ù„: Ø³Ø±ÙŠØŒ Ù…Ø®Ø·Ø·Ø§ØªØŒ Ø¹Ù‚ÙˆØ¯)
  color       String  @default("#6b7280") // Ù„ÙˆÙ† Ù…Ù…ÙŠØ² (tailwind color or hex)
  description String? // ÙˆØµÙ Ø§Ø®ØªÙŠØ§Ø±ÙŠ

  createdBy   Employee @relation("CreatedClassifications", fields: [createdById], references: [id])
  createdById String
  createdAt   DateTime @default(now())

  // Ø¹Ù„Ø§Ù‚Ø© Ø¨Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚
  documents Document[]

  @@index([createdById])
}